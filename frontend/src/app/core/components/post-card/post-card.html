@if (post; as postItem) {
  @if (link) {
    <a
      [routerLink]="['/post', postItem.documentId]"
      class="block w-full max-w-[500px]"
    >
      <ng-container
        *ngTemplateOutlet="cardTpl; context: { $implicit: postItem }"
      />
    </a>
  } @else {
    <ng-container
      *ngTemplateOutlet="cardTpl; context: { $implicit: postItem }"
    />
  }
}

<ng-template #cardTpl let-postItem>
  <p-card class="w-full overflow-hidden">
    <div class="flex flex-col gap-4">
      <div class="flex items-center gap-2">
        <app-avatar [userData]="postItem.author" size="sm" />
        <p class="opacity-60">{{ postItem.author.username }}</p>
      </div>
      <p class="text-sm" [class.line-clamp-3]="isMainPost">
        {{ postItem.content | richTextToPlain }}
      </p>
      @if (postItem.media) {
        <img
          [src]="postItem.media.url"
          [alt]="postItem.media.name"
          class="w-full h-auto object-cover"
        />
      }
      <div class="text-xs opacity-60 flex items-center justify-between gap-4">
        <p>
          @if (!isMainPost) {
            <i class="pi pi-comments"></i>
            {{ postItem.commentsTotal ?? 0 }}
          }
        </p>
        <p>
          @if (isMainPost) {
            {{ postItem.createdAt | date: "dd/MM/yyyy HH:mm" }}
          } @else {
            <span
              pTooltip="{{ postItem.createdAt | date: 'dd/MM/yyyy HH:mm' }}"
              tooltipPosition="top"
              tooltipStyleClass="text-xs"
              >{{ postItem.createdAt | dateFromNow }}</span
            >
          }
        </p>
      </div>
    </div>
  </p-card>
</ng-template>
